<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Berhitung</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
         :root {
            /* ... (variabel root tetap sama) ... */
             --transition-speed: 0.4s; /* Kecepatan transisi layar */
        }

        body {
            /* ... (style body tetap sama) ... */
            overflow-x: hidden; /* Mencegah scroll horizontal */
        }

        /* --- PERUBAHAN: Animasi Tombol Tekan (Sama seperti index.html) --- */
        .home-btn, .button-pilihan, .opsi, .home-btn-final /* Terapkan ke semua tombol */
        {
             transition: background-color 0.3s ease,
                         transform 0.15s ease; /* Transisi hover lebih lambat */
        }
        .home-btn:hover, .button-pilihan:hover, .opsi:hover, .home-btn-final:hover {
             transform: scale(1.03); /* Efek hover scale */
         }
         .home-btn:active, .button-pilihan:active, .opsi:active, .home-btn-final:active {
             transform: scale(0.98); /* Mengecil cepat saat ditekan */
             transition-duration: 0.05s; /* Transisi lebih cepat saat active */
         }
         /* Khusus warna hover tombol */
         .home-btn:hover { background-color: var(--home-btn-hover); }
         .button-pilihan:hover { background-color: var(--primary-hover); }
         .opsi:hover { background-color: var(--secondary-hover); }
         .home-btn-final:hover { background-color: var(--home-btn-hover); }


        h1 {
            /* ... (style h1 tetap sama) ... */
             opacity: 0;
             animation: fadeIn 1s ease-out forwards;
        }

        /* --- BARU: Styling untuk Transisi Layar --- */
        #menu-pilihan, #kuis-container, #final-score-overlay {
             transition: opacity var(--transition-speed) ease-out,
                         transform var(--transition-speed) ease-out;
             backface-visibility: hidden; /* Optimasi performa animasi */
        }

        .hidden-screen {
             opacity: 0 !important; /* Paksa opacity 0 */
             transform: translateY(20px); /* Mulai dari bawah sedikit */
             pointer-events: none; /* Tidak bisa diklik saat hidden */
             position: absolute; /* Hindari memengaruhi layout saat hidden (hati-hati jika butuh posisi lain) */
             width: 100%; /* Ambil lebar penuh saat absolute */
             left: 0;
         }
         .visible-screen {
             opacity: 1;
             transform: translateY(0);
             pointer-events: auto;
             position: relative; /* Kembali ke posisi normal */
         }
         /* Initial states */
         #kuis-container, #final-score-overlay {
             opacity: 0;
             pointer-events: none;
             transform: translateY(20px);
             /* Awalnya jangan absolute agar tidak tumpang tindih saat loading awal */
         }
         #menu-pilihan {
             opacity: 1; /* Menu pilihan tampil duluan */
              /* Animasi masuk untuk menu pilihan */
              animation: slideFadeIn 0.8s ease-out forwards;
              animation-delay: 0.3s;
         }


        /* Style Skor, Soal, Opsi (bisa ditambahkan animasi fade-in kecil saat soal baru) */
         #score-info, #soal, #opsiJawaban, #level-info, #progress-container {
            transition: opacity 0.3s ease-out;
         }
         .content-fade-out { opacity: 0; }
         .content-fade-in { opacity: 1; }

        #notifikasi-overlay {
            /* ... (style notifikasi overlay tetap) ... */
            transition: background-color 0.3s ease-out; /* Transisi background gelap */
        }
        #notifikasi {
             /* ... (style notifikasi tetap) ... */
             transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), /* Efek bounce */
                         opacity 0.3s ease-out;
             /* --- BARU: Container untuk Sparkle --- */
             position: relative; /* Agar sparkle bisa absolute di dalamnya */
        }
         #notifikasi-overlay.show #notifikasi { transform: scale(1); opacity: 1; }

        /* --- BARU: Sparkle Effect --- */
        .sparkle-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden;
            pointer-events: none;
            opacity: 0; /* Awalnya hidden */
            transition: opacity 0.5s ease-out;
        }
        #notifikasi.benar .sparkle-container {
            opacity: 1; /* Tampil saat notif benar */
        }

        .sparkle {
            position: absolute;
            color: #ffd700; /* Warna emas */
            font-size: 1rem; /* Ukuran bintang */
            animation: sparkleAnim 0.8s ease-out forwards;
            opacity: 0; /* Mulai transparan */
        }
        .sparkle.s1 { top: 10%; left: 15%; animation-delay: 0s; }
        .sparkle.s2 { top: 20%; left: 80%; animation-delay: 0.1s; font-size: 0.8rem; }
        .sparkle.s3 { top: 75%; left: 10%; animation-delay: 0.2s; font-size: 1.1rem; }
        .sparkle.s4 { top: 80%; left: 90%; animation-delay: 0.3s; }
        .sparkle.s5 { top: 40%; left: 50%; animation-delay: 0.15s; font-size: 0.9rem; }
        .sparkle.s6 { top: 60%; left: 30%; animation-delay: 0.25s; }


        @keyframes sparkleAnim {
            0% { transform: scale(0) rotate(0deg); opacity: 0.5; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        #final-score-overlay {
            /* ... (style final score overlay tetap) ... */
            /* Terapkan transisi yang sama dengan #kuis-container */
             transition: opacity var(--transition-speed) ease-out,
                         transform var(--transition-speed) ease-out;
             display: flex; /* Pastikan tetap flex saat visible */
        }

        .copyright { /* ... (style copyright tetap) ... */ }

         /* Keyframes untuk animasi masuk (jika diperlukan selain di index) */
         @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>
    <button class="home-btn" onclick="handleNavigation('index.html')"><i class="fas fa-home"></i> Home</button>

    <h1>Pilih Berhitung</h1>

    <!-- Tambah class visible/hidden -->
    <div id="menu-pilihan" class="visible-screen">
        <button class="button-pilihan" onclick="playSound('click-sound'); mulaiLevel('penjumlahan')"><i class="fas fa-plus"></i> Penjumlahan</button>
        <button class="button-pilihan" onclick="playSound('click-sound'); mulaiLevel('pengurangan')"><i class="fas fa-minus"></i> Pengurangan</button>
    </div>

    <!-- Tambah class visible/hidden -->
    <div id="kuis-container" class="hidden-screen">
        <div id="progress-container"> <div id="progress-bar"></div> </div>
        <div id="level-info"></div>
        <div id="score-info">Benar: 0 | Salah: 0</div>
        <div id="soal"></div>
        <div id="opsiJawaban"></div>
     </div>

    <div id="notifikasi-overlay">
        <div id="notifikasi">
            <!-- --- BARU: Sparkle Container --- -->
            <div class="sparkle-container">
                <i class="fas fa-star sparkle s1"></i>
                <i class="fas fa-star sparkle s2"></i>
                <i class="fas fa-star sparkle s3"></i>
                <i class="fas fa-star sparkle s4"></i>
                <i class="fas fa-star sparkle s5"></i>
                <i class="fas fa-star sparkle s6"></i>
            </div>
            <i class=""></i> <!-- Ikon notifikasi (check/cross/redo) -->
            <span id="notifikasi-teks"></span>
        </div>
    </div>

    <!-- Tambah class visible/hidden -->
    <div id="final-score-overlay" class="hidden-screen">
        <div id="final-score-content">
            <h2>Selamat! ðŸŽ‰</h2>
            <p id="final-score-text">Kamu menyelesaikan semua level!</p>
            <p id="final-score-detail">Skor Akhir: Benar: 0 | Salah: 0</p>
            <button class="home-btn-final" onclick="handleNavigation('index.html')">
                <i class="fas fa-home"></i> Kembali ke Home
            </button>
        </div>
    </div>

    <div class="copyright">Copyright Mas Har - B.3.9</div>

    <audio id="click-sound" src="ping.wav" preload="auto"></audio>
    <audio id="wrong-sound" src="gameovertwew.wav" preload="auto"></audio>

    <script>
        // ... (variabel dan data levels tetap sama) ...
        let scoreBenar = 0;
        let scoreSalah = 0;
        let currentTimeoutId = null; // Untuk clear timeout jika diperlukan

        const menuPilihanElem = document.getElementById('menu-pilihan');
        const kuisContainerElem = document.getElementById('kuis-container');
        const finalScoreOverlay = document.getElementById('final-score-overlay');
        const judulElem = document.querySelector('h1');
        const soalElem = document.getElementById('soal');
        const opsiJawabanContainer = document.getElementById('opsiJawaban');
        const scoreInfoElem = document.getElementById('score-info');
        // Referensi untuk konten kuis yang akan di-fade saat ganti soal/level
        const quizContentElements = [
            document.getElementById('progress-container'),
            document.getElementById('level-info'),
            scoreInfoElem,
            soalElem,
            opsiJawabanContainer
        ];


        function shuffleArray(array) { /* ... (tetap sama) ... */ }
        function generateOptions(correctAnswer) { /* ... (tetap sama) ... */ }

        // --- PERUBAHAN: Fungsi untuk Mengganti Layar ---
        function switchScreen(hideElement, showElement) {
             if (hideElement) {
                 hideElement.classList.remove('visible-screen');
                 hideElement.classList.add('hidden-screen');
                 // Set display none setelah transisi? Opsional, class hidden-screen sudah handle pointer-events
             }
             if (showElement) {
                 // Hapus display none jika ada (mungkin tidak perlu jika hanya mengandalkan class)
                 // showElement.style.display = showElement === finalScoreOverlay ? 'flex' : 'block'; // Atau 'flex' sesuai kebutuhan
                 showElement.classList.remove('hidden-screen');
                 showElement.classList.add('visible-screen');
             }
         }

        // --- PERUBAHAN: Terapkan switchScreen ---
        function mulaiLevel(jenis) {
            jenisSoal = jenis;
            currentLevel = 0;
            currentSoal = 0;
            scoreBenar = 0;
            scoreSalah = 0;
            updateScoreDisplay();
            switchScreen(finalScoreOverlay, null); // Sembunyikan final score jika ada
            switchScreen(menuPilihanElem, kuisContainerElem); // Ganti layar
            judulElem.textContent = jenis === 'penjumlahan' ? 'Penjumlahan' : 'Pengurangan';
            tampilkanSoal(); // Tampilkan soal pertama (setelah transisi)
        }

        // --- PERUBAHAN: Animasi fade content saat soal baru ---
        function tampilkanSoal() {
            // Hapus class fade-out dari konten jika ada
            quizContentElements.forEach(el => el.classList.remove('content-fade-out'));

            if (currentSoal >= soalPerLevel) {
                currentLevel++;
                currentSoal = 0;
                if (currentLevel >= totalLevel) {
                    tampilkanFinalScore();
                    return;
                } else {
                    // Fade out konten sebelum notif level baru
                     quizContentElements.forEach(el => el.classList.add('content-fade-out'));
                     setTimeout(() => {
                        tampilkanNotifikasi(`Level ${currentLevel + 1} Mulai!`, 'lanjut', true);
                        // Panggil update soal setelah notifikasi tampil sebentar
                        // dan konten sudah fade out
                         setTimeout(updateSoalDanOpsi, 800); // Delay untuk notif & fade
                     }, 300); // Delay kecil sebelum fade out total
                    return; // Hentikan eksekusi tampilkanSoal biasa
                }
            }

             // Jika bukan pergantian level, langsung update
             updateSoalDanOpsi();
        }

        // --- BARU: Fungsi terpisah untuk update DOM soal & opsi ---
         function updateSoalDanOpsi() {
             // Pastikan konten visible lagi
             quizContentElements.forEach(el => {
                 el.classList.remove('content-fade-out');
                 el.classList.add('content-fade-in'); // Trigger fade-in
             });

             let soal = levels[jenisSoal][currentLevel][currentSoal];
            jawabanBenar = jenisSoal === 'penjumlahan' ? soal.a + soal.b : soal.a - soal.b;
            soalElem.innerHTML = `${soal.a} ${jenisSoal === 'penjumlahan' ? '+' : 'âˆ’'} ${soal.b} = ?`;

            let opsiAcak = generateOptions(jawabanBenar);
            opsiJawabanContainer.innerHTML = '';
            opsiAcak.forEach(opsi => {
                const button = document.createElement('button');
                button.classList.add('opsi');
                button.textContent = opsi;
                button.onclick = () => { playSound('click-sound'); cekJawaban(opsi); };
                opsiJawabanContainer.appendChild(button);
            });

            updateProgressBar();
            disableOptions(false);

            // Hapus class fade-in setelah animasi selesai (opsional)
             setTimeout(() => {
                 quizContentElements.forEach(el => el.classList.remove('content-fade-in'));
             }, 300);
         }


        function disableOptions(disabled) { /* ... (tetap sama) ... */ }

        function cekJawaban(pilihan) {
            disableOptions(true);
            // Hapus timeout sebelumnya jika ada (mencegah double trigger soal baru)
            if (currentTimeoutId) clearTimeout(currentTimeoutId);

            if (parseInt(pilihan) === jawabanBenar) {
                scoreBenar++;
                updateScoreDisplay();
                tampilkanNotifikasi('Benar!', 'benar', true);

                currentTimeoutId = setTimeout(() => {
                    sembunyikanNotifikasi();
                    currentSoal++;
                    // Fade out content sebelum soal berikutnya
                    quizContentElements.forEach(el => el.classList.add('content-fade-out'));
                    setTimeout(tampilkanSoal, 300); // Panggil tampilSoal setelah fade out
                }, 1200);

            } else {
                scoreSalah++;
                updateScoreDisplay();
                playSound('wrong-sound');
                tampilkanNotifikasi('Salah! Coba lagi ya!', 'coba-lagi', false);

                currentTimeoutId = setTimeout(() => {
                    sembunyikanNotifikasi();
                    disableOptions(false);
                }, 1500);
            }
        }

        function updateScoreDisplay() { /* ... (tetap sama) ... */ }

        function tampilkanNotifikasi(pesan, tipe, autoHide) { // autoHide tidak dipakai lagi
            const overlay = document.getElementById('notifikasi-overlay');
            const notifikasi = document.getElementById('notifikasi');
            const notifikasiTeks = document.getElementById('notifikasi-teks');
            const ikon = notifikasi.querySelector('i:not(.sparkle)'); // Pilih ikon utama, bukan sparkle

            notifikasiTeks.textContent = pesan;
            // Reset class utama notifikasi & ikon utama
            notifikasi.className = '';
            if(ikon) ikon.className = '';

            notifikasi.classList.add('notifikasi'); // Tambahkan class dasar (jika ada styling)

            if (tipe === 'benar') {
                 notifikasi.classList.add('benar');
                 if(ikon) ikon.classList.add('fas', 'fa-check-circle');
            } else if (tipe === 'coba-lagi') {
                 notifikasi.classList.add('coba-lagi'); // Ganti nama class jika perlu styling beda
                 if(ikon) ikon.classList.add('fas', 'fa-redo');
            } else if (tipe === 'lanjut') {
                 notifikasi.classList.add('benar'); // Pakai style 'benar' untuk lanjut level
                 if(ikon) ikon.classList.add('fas', 'fa-arrow-circle-right');
            }
             // Tipe 'salah' tidak secara eksplisit dipakai untuk jawaban, tapi bisa untuk error lain
             else if (tipe === 'salah') {
                 notifikasi.classList.add('salah');
                 if(ikon) ikon.classList.add('fas', 'fa-times-circle');
             }


            overlay.style.display = 'flex';
            setTimeout(() => { overlay.classList.add('show'); }, 10); // Trigger transisi overlay
        }


        function sembunyikanNotifikasi() {
            const overlay = document.getElementById('notifikasi-overlay');
            overlay.classList.remove('show');
             // Tunggu transisi overlay selesai sebelum benar2 hide
             setTimeout(() => {
                 overlay.style.display = 'none';
                 // Reset class tipe notifikasi setelah disembunyikan
                 const notifikasi = document.getElementById('notifikasi');
                 notifikasi.className = 'notifikasi'; // Reset ke class dasar
            }, 300);
        }

        function updateProgressBar() { /* ... (tetap sama, perhitungannya sudah benar) ... */ }
        function playSound(soundId) { /* ... (tetap sama) ... */ }

        // --- PERUBAHAN: Terapkan switchScreen ---
        function tampilkanFinalScore() {
             switchScreen(kuisContainerElem, finalScoreOverlay); // Ganti layar
             sembunyikanNotifikasi();

             document.getElementById('final-score-text').textContent = `Kamu menyelesaikan semua ${totalLevel} level ${jenisSoal}!`;
             document.getElementById('final-score-detail').textContent = `Skor Akhir: Benar: ${scoreBenar} | Salah: ${scoreSalah}`;
         }

        // --- BARU: Handle Navigasi dengan Delay (Sama seperti index.html) ---
        function handleNavigation(url) {
            playSound('click-sound');
            // Beri sedikit waktu agar suara terdengar sebelum pindah halaman
            // Tambahkan efek fade out body (opsional)
            document.body.style.transition = 'opacity 0.2s ease-out';
            document.body.style.opacity = '0';
            setTimeout(() => {
                window.location.href = url;
            }, 200); // Delay sedikit lebih lama
        }

    </script>
</body>
</html>
